<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Lesson 03</title>

		<link rel="stylesheet" href="../../dist/reset.css">
		<link rel="stylesheet" href="../../dist/reveal.css">
		<link rel="stylesheet" href="../../dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="../../plugin/highlight/github-dark.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Network communication</h2>
					<h3>Lesson 03</h3>
					<h4>SWAFE-01</h4>
				</section>
				<section>
					<section id="network-communication">
						<h2 class="r-fit-text">Network</h2>
						<h3 class="r-fit-text">Communication<h3>
					</section>
					<section>
						<h2>Overview</h2>
						<ul>
							<li>Most dynamic web applications gets data from other sources</li>
							<li>Hypertext Transfer Protocol (HTTP) and WebSocket Protocol is commonly used to serve data</li>
						</ul>
					</section>
					<section>
						<h2>Client-server model</h2>
					</section>
				</section>
				<section>
					<section>
						<h2 class="r-fit-text">HTTP</h2>
						<h3 class="r-fit-text">Hypertext Transfer Protocol</h3>
					</section>
					<section id="http-specification">
						<h2>The HTTP/1.1 specification</h2>
						<ul>
							<li>Defined in IETF <a href="https://datatracker.ietf.org/doc/html/rfc2616">RFC 2616</a>
								<ul>
									<li>IETF – International Engineering Task Force</li>
									<li>RFC – Request For Comments</li>
								</ul>
							</li>
							<li>IETF is the Internet standards body
								<ul>
									<li>Developing open standards through open processes</li>
									<li>An international community of network designers, operators, vendors, and researchers</li>
									<li>Concerned with the evolution of the Internet architecture and the smooth operation of the Internet</li>
								</ul>
							</li>
							<li>An RFC is a publication format used by IETF
								<ul>
									<li>Protocols, procedures and programs</li>
									<li>Concepts</li>
									<li>Meeting notes</li>
								</ul>
							</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<ul>RFC 2616 is THE document for all your HTTP 1.1 needs</ul>
							<h4>References</h4>
							<ul>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616">rfc2616</a></li>
								<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview">HTTP | MDN</a></li>
								<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview">An overview of HTTP - HTTP | MDN</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>HTTP methods</h2>
						<ul>
							<li>POST
								<ul>
									<li>Send data to the server</li>
								</ul>
							</li>
							<li>GET
								<ul>
									<li>Retrieve data from the server</li>
								</ul>
							</li>
							<li>PUT
								<ul>
									<li>Send data to the server and update an existing entity</li>
								</ul>
							</li>
							<li>DELETE
								<ul>
									<li>Remove an entity on the server</li>
								</ul>
							</li>
							<li>OPTIONS
								<ul>
									<li>Get information about the communication options available</li>
								</ul>
							</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9">rfc2616 – Method definitions</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9.2">rfc – OPTIONS</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9.3">rfc2616 – GET</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9.5">rfc2616 – POST</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9.6">rfc2616 – PUT</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc2616#section-9.7">rfc2616 – DELETE</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>HTTP Response codes</h2>
						<ul>
							<li><code>1xx</code>: Informational</li>
							<li><code>2xx</code>: Success</li>
							<li><code>3xx</code>: Redirection</li>
							<li><code>4xx</code>: Client error</li>
							<li><code>5xx</code>: Server error</li>
						</ul>
					</section>
					<section>
						<h2>HTTP specifications</h2>
						<ul>
							<li>Initial releases
								<ul>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc2068">RFC 2068</a> Hypertext Transfer Protocol -- HTTP/1.1 <em>January 1997</em></li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc2616">RFC 2616</a> Hypertext Transfer Protocol -- HTTP/1.1 <em>June 1999</em></li>
								</ul>
							</li>
							<li>Updated and split up in June 2014
								<ul>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7230">RFC 7230</a> HTTP/1.1: Message Syntax and Routing</li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7231">RFC 7231</a> HTTP/1.1: Sematics and Content</li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7232">RFC 7232</a> HTTP/1.1: Conditional Requests</li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7233">RFC 7233</a> HTTP/1.1: Range Requests</li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7234">RFC 7234</a> HTTP/1.1: Caching</li>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7235">RFC 7235</a> HTTP/1.1: Authentication</li>
								</ul>
							</li>
							<li>Other versions
								<ul>
									<li><a href="https://datatracker.ietf.org/doc/html/rfc7540">RFC 7540</a> Hypertext Transfer Protocol Version 2 (HTTP/2) <em>(May 2015)</em></li>
									<li><a href="https://datatracker.ietf.org/doc/draft-ietf-quic-http/34/">draft-ietf-quic-http-34</a> Hypertext Transfer Protocol Version 3 (HTTP/3) <em>(February 2021)</em></li>
								</ul>
							</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7230">rfc7230</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7231">rfc7231</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7232">rfc7232</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7233">rfc7233</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7234">rfc7234</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7235">rfc7235</a></li>
								<li><a href="https://datatracker.ietf.org/doc/html/rfc7540">rfc7540</a></li>
								<li><a href="https://datatracker.ietf.org/doc/draft-ietf-quic-http/34/">draft-ietf-quic-http-34 - Hypertext Transfer Protocol Version 3 (HTTP/3)</a></li>
							</ul>
						</aside>
					</section>
				</section>
				<section>
					<section>
						<h2>HTTP communication in Angular</h2>
					</section>
					<section id="http-communication-in-angular">
						<h2>Overview</h2>
						<ul>
							<li>The ability to request typed response objects</li>
							<li>Streamlined error handling</li>
							<li>Request and response interception</li>
							<li>Testability features</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://angular.io/guide/http">Angular - Communicating with backend services using HTTP</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>HTTPClientModule</h2>
						<pre><code class='typescript' data-trim data-line-numbers="|3,15|"><script type="text/template">
							import { NgModule } from '@angular/core';
							import { BrowserModule } from '@angular/platform-browser';
							import { HttpClientModule } from '@angular/common/http';
							
							import { AppRoutingModule } from './app-routing.module';
							import { AppComponent } from './app.component';
							
							@NgModule({
								declarations: [
									AppComponent
								],
								imports: [
									BrowserModule,
									AppRoutingModule,
									HttpClientModule,
								],
								providers: [],
								bootstrap: [AppComponent]
							})
							export class AppModule { }
						</script></code></pre>	
						<small>examples/lesson03-network-communication/projects/server-communication/src/app/app.module.ts</small>
					</section>
					<section>
						<h2><code>HttpClient</code></h2>
						<ul>
							<li>Wraps HTTP requests in <code>Observable</code> objects</li>
							<li>Contains methods for some of the most used HTTP requests
								<ul>
									<li><code>get()</code> returns a configured <code>GET</code> HTTP request</li>
									<li><code>post()</code> returns a configured <code>POST</code> HTTP request</li>
									<li><code>delete()</code> returns a configured <code>DELETE</code> HTTP request</li>
									<li><code>request()</code> returns a generic HTTP request</li>
								</ul>
							</li>
							<li>Used in combination with RxJS operators to filter values and format to desired output</li>
							<li>Can be initiated with <code>subscribe()</code> or <code>async</code> pipe</li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>Reference</h4>
							<ul>
								<li><a href="https://angular.io/api/common/http/HttpClient">Angular - HttpClient</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2><code>SpaceService</code></h2>
						<pre><code class='typescript' data-trim data-line-numbers="|1,13|15-17|19-21|"><script type="text/template">
							import { HttpClient } from '@angular/common/http';
							import { Injectable } from '@angular/core';
							import { Astronaut, LaunchVehicles } from 'lib-space';
							import { Observable } from 'rxjs';
							import { environment } from '../environments/environment';
							
							@Injectable({
								providedIn: 'root'
							})
							export class SpaceService {
								rootUrl = `http://${environment.api.space.host}:${environment.api.space.port}`
							
								constructor(private http: HttpClient) { }
							
								getAstronauts(): Observable<Astronaut[]> {
									return this.http.get<Astronaut[]>(`${this.rootUrl}/astronauts`)
								}
							
								getLaunchVehicles(): Observable<LaunchVehicles[]> {
									return this.http.get<LaunchVehicles[]>(`${this.rootUrl}/launch_vehicles`)
								}
							}
						</script></code></pre>
						<small>examples/lesson03-network-communication/projects/server-communication/src/app/space.service.ts</small>
					</section>
				</section>
				<section>
					<section id="type-response">
						<h2>Typed response</h2>
						<ul>
							<li>Consume output more easily and obvious</li>
							<li>Response types can act at type assertion at compile time
								<ul>
									<li>But is not guranteed that the server will respond with the expected type</li>
									<li>Be sure to have proper <a href="#/error-handling">error handling</a></li>
								</ul>
							</li>
							<li>RxJS transformation
								<ul>
									<li>Use the map operator to transform response data as needed by the UI</li>
									<li>Read the transformed data with the <code>async</code> pipe in the template</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h2>Response type for <code>Astronaut</code></h2>
						<pre><code class='typescript' data-trim data-line-numbers><script type="text/template">
							export interface Astronaut {
								name: string;
								nationality: string;
								organization: string;
								status?: string;
								born: number;
								died?: number;
								time_in_space?: number;
							}
						</script></code></pre>
						<small>examples/lesson03-network-communication/projects/lib-space/src/lib/astronaut.type.ts</small>
					</section>
					<section>
						<h2>Response type for <code>LaunchVehicle</code></h2>
						<pre><code class='typescript' data-trim data-line-numbers><script type="text/template">
							export interface LaunchVehicles {
								name: string;
								country: string;
								height: number;
								status: string;
								mass: number;
								launch_history: {
									first: number;
									last?: number;
									total: number;
								} 
							}
						</script></code></pre>
						<small>examples/lesson03-network-communication/projects/lib-space/src/lib/launch-vehicle.type.ts</small>
					</section>
					<section>
						<h2>Requesting data from a server</h2>
						<pre><code class="typescript" data-trim data-line-numbers="|5,17|14,15|14,20|15,21-23|"><script type="text/template">
							import { Component, OnInit } from '@angular/core';
							import { LaunchVehicles } from 'lib-space';
							import { Observable } from 'rxjs';
							import { map } from 'rxjs/operators';
							import { SpaceService } from './space.service';
							
							@Component({
								selector: 'app-root',
								templateUrl: './app.component.html',
								styleUrls: ['./app.component.scss']
							})
							export class AppComponent implements OnInit {
							
								launchVehicles$: Observable<LaunchVehicles[]> | null = null;
								astronauts$: Observable<string[]> | null = null;
							
								constructor(private spaceService: SpaceService) { }
							
								ngOnInit() {
									this.launchVehicles$ = this.spaceService.getLaunchVehicles();
									this.astronauts$ = this.spaceService.getAstronauts().pipe(
										map(astronauts => astronauts.map(astronaut => astronaut.name))
									);
								}
							}													
						</script></code></pre>
						<small>examples/lesson03-network-communication/projects/server-communication/src/app/app.component.ts</small>
					</section>
					<section>
						<h2>Display data in templates</h2>
						<pre><code class="html" data-trim data-line-numbers="|3-5|9-11|"><script type="text/template">
							<h2>Astronauts</h2>
							<ul>  
								<li *ngFor="let astronaut of astronauts$ | async">
									{{ astronaut }}
								</li>
							</ul>
							<h2>Launch vehicles</h2>
							<ul>
								<li *ngFor="let launchVehicle of launchVehicles$ | async">
									{{ launchVehicle | json }}
								</li>
							<ul>												
						</script></code></pre>
						<small>examples/lesson03-network-communication/projects/server-communication/src/app/app.component.html</small>	
					</section>
				</section>
				<section>
					<section id="cors">
						<h2>Same-Origin security model</h2>
						<h5>&</h5>
						<h2>Cross-Origin Resource Sharing</h2>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://www.npmjs.com/package/cors">cors - npm</a></li>
								<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same-origin policy - Web security | MDN</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Overview</h2>
						<ul> 
							<li>The Cross-Origin Resource Sharing (CORS) standard adds new HTTP headers, that let servers describe which origins are premitted to access data from a web browser</li>
							<li>CORS failures results in errors, but for security reasons, specifics about the error are not available to JavaScript</li>
					</ul>
					<aside class="notes" aria-label="notes">
						<h4>References</h4>
						<ul>
							<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS) - HTTP | MDN</a></li>
						</ul>
					</aside>
				</section>
				<section>
					<h2>Same-origin policy</h2>
					<ul>
						<li>The same-origin policy is a critical security mechanism that restricts how documents and scripts loaded by one origin can interact with a resource from another origin</li>
						<li>Definition of an origin</li>
						<ul>
							<li>A origin is a tuple comprised of <code>[protocol, host, port]</code>
								<ul>
									<li><code>protocol</code>—The protocol used: <code>http://</code>, <code>https://</code>, etc.</li>
									<li><code>host</code>—The resource location: swafe-01.dk, ece.au.dk, etc.</li>
									<li><code>port</code>—The port number, if specified</li>
								</ul>
							</li>
						</ul>
					</li>
					<li>Implemented by the most commonly used browsers (Google Chrome, Firefox, Microsoft Edge, etc.)
					</ul>
						<aside class="notes" aria-label="notes">
							<h4>Reference</h4>
							<ul>
								<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same-origin policy - Web security | MDN</a></li>
							</ul>
						</aside>
					</section>
					<section>
						<h2>Proxying to a backend server</h2>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://angular.io/guide/build#building-and-serving-angular-apps">Angular - Building and serving Angular apps</a></li>
							</ul>
						</aside>
					</section>
				</section>
				<section>
					<section id="error-handling">
						<h2>Error handling</h2>
						<ul>
							<li>If the request fails, HttpClient returns an error object instead of a successfully response</li>
							<li></li>
						</ul>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://angular.io/guide/http#handling-request-errors">Angular - Communicating with backend services using HTTP</a></li>
							</ul>								
						</aside>
					</section>
					<section>
						<h2></h2>
					</section>
				</section>
				<section>
					<section>
						<h2>Interception</h2>
					</section>
					<section>
						<h2>Request and response interception</h2>
						<ul>
							<li>Request and response transformation
								<ul>
									<li>Before sending a request to the server</li>
									<li>Before receiving a response in the application</li>
								</ul>
							</li>
							<li>Perform implicit tasks
								<ul>
									<li>Such as setting an authentication token for all requests sent to the server</li>
									<li>Alternatively implemented explicitly for every method call</li>
								</ul>
							</li>
						</ul>
					</section>
					<section>
						<h2>Code example</h2>
						<pre><code class='typescript' data-trim data-line-numbers="|9|10|12-15|"><script type="text/template">
						import { Injectable } from '@angular/core';
						import {
							HttpEvent, HttpInterceptor, HttpHandler, HttpRequest
						} from '@angular/common/http';

						import { Observable } from 'rxjs';

						/** Pass untouched request through to the next request handler. */
						@Injectable()
						export class NoopInterceptor implements HttpInterceptor {

							intercept(req: HttpRequest<any>, next: HttpHandler):
								Observable<HttpEvent<any>> {
								return next.handle(req);
							}
						}
						</script></code></pre>
						<aside class="notes" aria-label="notes">
							<h4>References</h4>
							<ul>
								<li><a href="https://angular.io/guide/http#write-an-interceptor">Angular - Communicating with backend services using HTTP</a></li>
							</ul>
						</aside>
					</section>
				</section>
			</div>
		</div>

		<script src="../../dist/reveal.js"></script>
		<script src="../../plugin/notes/notes.js"></script>
		<script src="../../plugin/markdown/markdown.js"></script>
		<script src="../../plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
